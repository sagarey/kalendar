name: Android Emulator Testing

on:
  pull_request:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      branch:
        description: 'è¦æµ‹è¯•çš„åˆ†æ”¯åç§°'
        required: false
        default: 'main'
        type: string

# ä¼˜åŒ–å¹¶å‘æŽ§åˆ¶ï¼Œé¿å…é‡å¤è¿è¡Œ
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  emulator-test:
    runs-on: ubuntu-latest-4-cores
    timeout-minutes: 30
    env:
      # ä¼˜åŒ– Gradle æ€§èƒ½
      GRADLE_OPTS: -Dorg.gradle.daemon=true -Dorg.gradle.parallel=true -Dorg.gradle.configureondemand=true -Dorg.gradle.jvmargs="-Xmx4g -XX:+UseG1GC"
      # Android ç›¸å…³çŽ¯å¢ƒå˜é‡
      ANDROID_COMPILE_SDK: 34
      ANDROID_BUILD_TOOLS: 34.0.0
      ANDROID_SDK_TOOLS: 9477386
      API_LEVEL: 34
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          ref: ${{ github.event.inputs.branch || github.ref }}

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Cache Gradle dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v3
        with:
          cache-read-only: false

      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      - name: Pre-download dependencies
        run: |
          ./gradlew dependencies --no-daemon --stacktrace

      - name: Cache Android SDK
        uses: actions/cache@v4
        with:
          path: |
            /usr/local/lib/android/sdk
            ~/.android
          key: ${{ runner.os }}-android-sdk-${{ env.API_LEVEL }}
          restore-keys: |
            ${{ runner.os }}-android-sdk-

      - name: Setup Android SDK
        uses: android-actions/setup-android@v3

      - name: Enable KVM and optimize for x86_64
        run: |
          echo "ðŸš€ å‡†å¤‡ Android æ¨¡æ‹Ÿå™¨çŽ¯å¢ƒ..."
          
          # å¯ç”¨ KVM ç¡¬ä»¶åŠ é€Ÿ
          echo "âš™ï¸ é…ç½® KVM ç¡¬ä»¶åŠ é€Ÿ..."
          echo 'KERNEL=="kvm", GROUP="kvm", MODE="0666", OPTIONS+="static_node=kvm"' | sudo tee /etc/udev/rules.d/99-kvm4all.rules
          sudo udevadm control --reload-rules
          sudo udevadm trigger --name-match=kvm
          
          # æ£€æŸ¥ KVM æ”¯æŒ
          echo "ðŸ” æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ..."
          if [ -r /dev/kvm ]; then
            echo "âœ… KVM ç¡¬ä»¶åŠ é€Ÿå¯ç”¨"
            KVM_STATUS="âœ… å¯ç”¨"
          else
            echo "âš ï¸ KVM ç¡¬ä»¶åŠ é€Ÿä¸å¯ç”¨"
            KVM_STATUS="âš ï¸ ä¸å¯ç”¨"
          fi
          
          # æ˜¾ç¤ºè¯¦ç»†çš„ç³»ç»Ÿä¿¡æ¯
          echo "ðŸ“Š ç³»ç»ŸçŽ¯å¢ƒä¿¡æ¯:"
          echo "   ðŸ–¥ï¸ CPU æž¶æž„: $(lscpu | grep 'Architecture:' | awk '{print $2}')"
          echo "   ðŸ”§ CPU åž‹å·: $(lscpu | grep 'Model name:' | cut -d':' -f2 | xargs)"
          echo "   ðŸ’¾ CPU æ ¸å¿ƒ: $(lscpu | grep '^CPU(s):' | awk '{print $2}')"
          echo "   âš¡ KVM çŠ¶æ€: $KVM_STATUS"
          
          # æ£€æŸ¥è™šæ‹ŸåŒ–æ”¯æŒ
          echo "ðŸ” è™šæ‹ŸåŒ–ç‰¹æ€§:"
          VIRT_FEATURES=$(lscpu | grep -E "Virtualization|Hypervisor" || echo "æ— è™šæ‹ŸåŒ–ç‰¹æ€§ä¿¡æ¯")
          echo "   $VIRT_FEATURES"
          
          # æ˜¾ç¤ºå¯ç”¨å†…å­˜
          echo "ðŸ’¾ å†…å­˜ä¿¡æ¯:"
          free -h | grep -E "Mem:|Swap:" | sed 's/^/   /'

      - name: Cache Android Emulator
        uses: actions/cache@v4
        with:
          path: |
            ~/.android/avd/*
            ~/.android/adb*
          key: ${{ runner.os }}-android-emulator-${{ hashFiles('~/.android/avd/**/config.ini') }}
          restore-keys: |
            ${{ runner.os }}-android-emulator-

      - name: Start Android Emulator
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: ${{ env.API_LEVEL }}
          target: google_apis
          arch: x86_64
          profile: Nexus 6
          avd-name: test-device-api${{ env.API_LEVEL }}-x86_64
          force-avd-creation: false
          emulator-options: -no-window -gpu swiftshader_indirect -noaudio -no-boot-anim -camera-back none -camera-front none -qemu -m 2048 -smp 2 -accel kvm
          disable-animations: true
          disable-spellchecker: true
          disable-linux-hw-accel: false
          emulator-build: 7425822
          script: |
            echo "ðŸ“± Android æ¨¡æ‹Ÿå™¨å·²å¯åŠ¨ï¼Œå¼€å§‹é…ç½®..."
            
            # æ˜¾ç¤ºè¿žæŽ¥çš„è®¾å¤‡
            echo "ðŸ”Œ å·²è¿žæŽ¥çš„è®¾å¤‡:"
            adb devices
            
            # å…³é—­åŠ¨ç”»ä»¥åŠ é€Ÿæµ‹è¯•
            echo "âš¡ ä¼˜åŒ–æ¨¡æ‹Ÿå™¨æ€§èƒ½ï¼ˆå…³é—­åŠ¨ç”»ï¼‰..."
            adb shell settings put global window_animation_scale 0
            adb shell settings put global transition_animation_scale 0
            adb shell settings put global animator_duration_scale 0
            echo "âœ… åŠ¨ç”»å·²ç¦ç”¨"
            
            # è®¾ç½®ç³»ç»Ÿè¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡
            echo "ðŸŒ è®¾ç½®ç³»ç»Ÿè¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡..."
            adb shell "setprop persist.sys.locale zh-CN && setprop persist.sys.language zh && setprop persist.sys.country CN"
            adb shell "am broadcast -a android.intent.action.LOCALE_CHANGED"
            
            # ç­‰å¾…è¯­è¨€è®¾ç½®ç”Ÿæ•ˆ
            echo "â³ ç­‰å¾…è¯­è¨€è®¾ç½®ç”Ÿæ•ˆ..."
            sleep 3
            
            # éªŒè¯è¯­è¨€è®¾ç½®
            CURRENT_LOCALE=$(adb shell getprop persist.sys.locale)
            echo "âœ… å½“å‰ç³»ç»Ÿè¯­è¨€: $CURRENT_LOCALE"
            
            # èŽ·å–å¹¶æ˜¾ç¤ºè¯¦ç»†çš„æ¨¡æ‹Ÿå™¨ä¿¡æ¯
            echo "ðŸ“Š æ¨¡æ‹Ÿå™¨çŽ¯å¢ƒè¯¦æƒ…:"
            echo "   ðŸ·ï¸ è®¾å¤‡åž‹å·: $(adb shell getprop ro.product.model)"
            echo "   ðŸ”§ è®¾å¤‡å“ç‰Œ: $(adb shell getprop ro.product.brand)"
            echo "   ðŸ†” è®¾å¤‡ID: $(adb shell getprop ro.product.device)"
            echo "   ðŸ“ å±å¹•å¯†åº¦: $(adb shell getprop ro.sf.lcd_density)"
            echo "   ðŸ“± å±å¹•åˆ†è¾¨çŽ‡: $(adb shell wm size | cut -d' ' -f3)"
            
            # éªŒè¯æ¨¡æ‹Ÿå™¨æž¶æž„
            echo "ðŸ—ï¸ æž¶æž„ä¿¡æ¯:"
            CPU_ABI=$(adb shell getprop ro.product.cpu.abi)
            CPU_ABI_LIST=$(adb shell getprop ro.product.cpu.abilist)
            echo "   ðŸŽ¯ ä¸»è¦æž¶æž„: $CPU_ABI"
            echo "   ðŸ“‹ æ”¯æŒæž¶æž„: $CPU_ABI_LIST"
            
            # éªŒè¯ Android ç‰ˆæœ¬
            echo "ðŸ¤– Android ç‰ˆæœ¬:"
            ANDROID_VERSION=$(adb shell getprop ro.build.version.release)
            SDK_VERSION=$(adb shell getprop ro.build.version.sdk)
            BUILD_ID=$(adb shell getprop ro.build.id)
            echo "   ðŸ“± Android: $ANDROID_VERSION (API $SDK_VERSION)"
            echo "   ðŸ—ï¸ æž„å»º: $BUILD_ID"
            
            # éªŒè¯ç¡¬ä»¶åŠ é€ŸçŠ¶æ€
            echo "âš¡ å›¾å½¢åŠ é€Ÿ:"
            QEMU_GLES=$(adb shell getprop ro.kernel.qemu.gles 2>/dev/null || echo "ç¡¬ä»¶åŠ é€Ÿæ¨¡å¼")
            echo "   ðŸŽ® GLES: $QEMU_GLES"
            
            # æ£€æŸ¥å¯ç”¨å­˜å‚¨ç©ºé—´
            echo "ðŸ’¾ å­˜å‚¨ç©ºé—´:"
            adb shell df /data | tail -1 | awk '{print "   ðŸ“ /data: " $4 " å¯ç”¨ (" $5 " å·²ç”¨)"}'
            
            # æ£€æŸ¥å†…å­˜ä½¿ç”¨
            echo "ðŸ§  å†…å­˜çŠ¶æ€:"
            MEMINFO=$(adb shell cat /proc/meminfo | grep -E "MemTotal|MemAvailable" | awk '{print $2}' | paste - -)
            echo "   ðŸ’¾ å†…å­˜: $(echo $MEMINFO | awk '{printf "%.1fGB å¯ç”¨ / %.1fGB æ€»è®¡", $2/1024/1024, $1/1024/1024}')"
            
            echo "ðŸŽ‰ æ¨¡æ‹Ÿå™¨é…ç½®å®Œæˆï¼"

      - name: Cache build outputs
        uses: actions/cache@v4
        with:
          path: |
            app/build/intermediates
            app/build/tmp
          key: ${{ runner.os }}-build-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-build-

      - name: Build and Install APK
        run: |
          echo "ðŸ”¨ å¼€å§‹æž„å»º APK..."
          BUILD_START_TIME=$(date +%s)
          
          # æž„å»º APKï¼ˆå¸¦é‡è¯•æœºåˆ¶å’Œè¯¦ç»†æ—¥å¿—ï¼‰
          for i in {1..3}; do
            echo "ðŸ“¦ ç¬¬ $i æ¬¡æž„å»ºå°è¯•..."
            if ./gradlew assembleFossDebug --parallel --configure-on-demand --stacktrace --build-cache; then
              echo "âœ… æž„å»ºæˆåŠŸ"
              BUILD_END_TIME=$(date +%s)
              BUILD_DURATION=$((BUILD_END_TIME - BUILD_START_TIME))
              echo "â±ï¸ æž„å»ºè€—æ—¶: ${BUILD_DURATION}s"
              break
            else
              echo "âŒ æž„å»ºå¤±è´¥ï¼Œé‡è¯• $i/3"
              if [ $i -eq 3 ]; then 
                echo "ðŸ’¥ æž„å»ºæœ€ç»ˆå¤±è´¥ï¼Œé€€å‡º"
                exit 1
              fi
              ./gradlew clean
              echo "ðŸ§¹ æ¸…ç†ç¼“å­˜å®Œæˆï¼Œç­‰å¾…é‡è¯•..."
              sleep 15
            fi
          done
          
          # æ£€æŸ¥å¹¶æ˜¾ç¤º APK ä¿¡æ¯
          APK_PATH="app/build/outputs/apk/foss/debug/app-foss-debug.apk"
          if [ -f "$APK_PATH" ]; then
            APK_SIZE=$(du -h "$APK_PATH" | cut -f1)
            echo "ðŸ“± APK æ–‡ä»¶ä¿¡æ¯:"
            echo "   ðŸ“ è·¯å¾„: $APK_PATH"
            echo "   ðŸ“ å¤§å°: $APK_SIZE"
            echo "   ðŸ” MD5: $(md5sum "$APK_PATH" | cut -d' ' -f1)"
          else
            echo "âŒ APK æ–‡ä»¶ä¸å­˜åœ¨: $APK_PATH"
            exit 1
          fi
          
          # å®‰è£… APKï¼ˆå¸¦é‡è¯•æœºåˆ¶å’Œè¯¦ç»†æ—¥å¿—ï¼‰
          echo "ðŸ“² å¼€å§‹å®‰è£… APK..."
          for i in {1..3}; do
            echo "ðŸ”§ ç¬¬ $i æ¬¡å®‰è£…å°è¯•..."
            if adb install -r "$APK_PATH"; then
              echo "âœ… å®‰è£…æˆåŠŸ"
              # éªŒè¯å®‰è£…
              PACKAGE_NAME="org.fossify.calendar"
              if adb shell pm list packages | grep -q "$PACKAGE_NAME"; then
                echo "ðŸŽ¯ åº”ç”¨åŒ…éªŒè¯æˆåŠŸ: $PACKAGE_NAME"
                INSTALLED_VERSION=$(adb shell dumpsys package "$PACKAGE_NAME" | grep versionName | head -1 | cut -d'=' -f2)
                echo "ðŸ“‹ å·²å®‰è£…ç‰ˆæœ¬: $INSTALLED_VERSION"
              else
                echo "âš ï¸ åº”ç”¨åŒ…éªŒè¯å¤±è´¥"
              fi
              break
            else
              echo "âŒ å®‰è£…å¤±è´¥ï¼Œé‡è¯• $i/3"
              if [ $i -eq 3 ]; then 
                echo "ðŸ’¥ å®‰è£…æœ€ç»ˆå¤±è´¥ï¼Œé€€å‡º"
                exit 1
              fi
              sleep 5
            fi
          done

      - name: Test and Verify Installation
        run: |
          echo "ðŸ” éªŒè¯åº”ç”¨å®‰è£…å’ŒåŠŸèƒ½..."
          
          # æ£€æŸ¥å·²å®‰è£…çš„åŒ…
          echo "ðŸ“¦ å·²å®‰è£…çš„ FOSS ç›¸å…³åŒ…:"
          adb shell pm list packages | grep foss || echo "âš ï¸ æœªæ‰¾åˆ° FOSS ç›¸å…³åŒ…"
          
          # èŽ·å–è®¾å¤‡ä¿¡æ¯
          echo "ðŸ“± è®¾å¤‡ä¿¡æ¯:"
          echo "   ðŸ·ï¸ è®¾å¤‡åž‹å·: $(adb shell getprop ro.product.model)"
          echo "   ðŸ¤– Android ç‰ˆæœ¬: $(adb shell getprop ro.build.version.release)"
          echo "   ðŸŽ¯ API çº§åˆ«: $(adb shell getprop ro.build.version.sdk)"
          echo "   ðŸ—ï¸ æž¶æž„: $(adb shell getprop ro.product.cpu.abi)"
          echo "   ðŸŒ è¯­è¨€: $(adb shell getprop persist.sys.locale)"
          
          # æ£€æŸ¥åº”ç”¨æƒé™
          PACKAGE_NAME="org.fossify.calendar"
          echo "ðŸ” åº”ç”¨æƒé™æ£€æŸ¥:"
          adb shell dumpsys package "$PACKAGE_NAME" | grep permission | head -5 || echo "âš ï¸ æƒé™ä¿¡æ¯èŽ·å–å¤±è´¥"
          
          # å°è¯•å¯åŠ¨åº”ç”¨
          echo "ðŸš€ å°è¯•å¯åŠ¨åº”ç”¨..."
          adb shell am start -n "$PACKAGE_NAME/.activities.SplashActivity" || \
          adb shell am start -n "$PACKAGE_NAME/.activities.MainActivity" || \
          echo "âš ï¸ åº”ç”¨å¯åŠ¨å¯èƒ½å¤±è´¥ï¼Œä½†è¿™ä¸ä¸€å®šè¡¨ç¤ºå®‰è£…å¤±è´¥"
          
          # ç­‰å¾…åº”ç”¨å¯åŠ¨
          sleep 5
          
          # æˆªå›¾
          echo "ðŸ“¸ æ•èŽ·å±å¹•æˆªå›¾..."
          SCREENSHOT_PATH="/sdcard/test_screenshot_$(date +%Y%m%d_%H%M%S).png"
          if adb shell screencap -p "$SCREENSHOT_PATH"; then
            if adb pull "$SCREENSHOT_PATH" ./screenshot.png; then
              echo "âœ… æˆªå›¾ä¿å­˜æˆåŠŸ: screenshot.png"
              SCREENSHOT_SIZE=$(du -h ./screenshot.png | cut -f1)
              echo "   ðŸ“ æˆªå›¾å¤§å°: $SCREENSHOT_SIZE"
            else
              echo "âŒ æˆªå›¾ä¸‹è½½å¤±è´¥"
            fi
            adb shell rm "$SCREENSHOT_PATH"
          else
            echo "âŒ æˆªå›¾æ•èŽ·å¤±è´¥"
          fi
          
          # èŽ·å–åº”ç”¨æ—¥å¿—
          echo "ðŸ“‹ èŽ·å–åº”ç”¨æ—¥å¿—..."
          adb logcat -d | grep "$PACKAGE_NAME" | tail -10 > app_logs.txt || echo "âš ï¸ æ— åº”ç”¨æ—¥å¿—"
          if [ -s app_logs.txt ]; then
            echo "âœ… åº”ç”¨æ—¥å¿—å·²ä¿å­˜: app_logs.txt"
            echo "ðŸ“„ æœ€åŽå‡ è¡Œæ—¥å¿—:"
            tail -3 app_logs.txt
          else
            echo "â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°åº”ç”¨æ—¥å¿—"
          fi

      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: android-test-results-${{ github.run_number }}
          path: |
            screenshot.png
            app_logs.txt
            app/build/outputs/apk/foss/debug/app-foss-debug.apk
          retention-days: 30

      - name: Test Summary
        if: always()
        run: |
          TEST_END_TIME=$(date +%s)
          TEST_DURATION=$((TEST_END_TIME - SECONDS))
          BRANCH_NAME="${{ github.event.inputs.branch || github.ref_name }}"
          
          echo "## ðŸ§ª Android æ¨¡æ‹Ÿå™¨æµ‹è¯•å®Œæˆ!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### â±ï¸ æµ‹è¯•æ—¶é—´" >> $GITHUB_STEP_SUMMARY
          echo "- **æµ‹è¯•åˆ†æ”¯**: $BRANCH_NAME" >> $GITHUB_STEP_SUMMARY
          echo "- **æµ‹è¯•æ—¶é•¿**: ${TEST_DURATION}s" >> $GITHUB_STEP_SUMMARY
          echo "- **Runner**: ubuntu-latest-4-cores" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Œæˆæ—¶é—´**: $(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ðŸ“± æµ‹è¯•çŽ¯å¢ƒ" >> $GITHUB_STEP_SUMMARY
          echo "- **Android API**: ${{ env.API_LEVEL }}" >> $GITHUB_STEP_SUMMARY
          echo "- **æ¨¡æ‹Ÿå™¨æž¶æž„**: x86_64" >> $GITHUB_STEP_SUMMARY
          echo "- **æ¨¡æ‹Ÿå™¨é…ç½®**: Nexus 6, KVM åŠ é€Ÿ" >> $GITHUB_STEP_SUMMARY
          echo "- **ç³»ç»Ÿè¯­è¨€**: ç®€ä½“ä¸­æ–‡" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ðŸ“‹ æž„å»ºä¿¡æ¯" >> $GITHUB_STEP_SUMMARY
          echo "- **æäº¤**: ${GITHUB_SHA:0:7}" >> $GITHUB_STEP_SUMMARY
          echo "- **æž„å»ºå˜ä½“**: foss-debug" >> $GITHUB_STEP_SUMMARY
          echo "- **Gradle ä¼˜åŒ–**: å¹¶è¡Œæž„å»º, æŒ‰éœ€é…ç½®, æž„å»ºç¼“å­˜" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # æ£€æŸ¥æµ‹è¯•ç»“æžœ
          if [ -f "screenshot.png" ]; then
            SCREENSHOT_SIZE=$(du -h screenshot.png | cut -f1)
            echo "### âœ… æµ‹è¯•ç»“æžœ" >> $GITHUB_STEP_SUMMARY
            echo "- **APK å®‰è£…**: æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
            echo "- **åº”ç”¨å¯åŠ¨**: å°è¯•å¯åŠ¨" >> $GITHUB_STEP_SUMMARY
            echo "- **å±å¹•æˆªå›¾**: å·²ç”Ÿæˆ ($SCREENSHOT_SIZE)" >> $GITHUB_STEP_SUMMARY
          else
            echo "### âŒ æµ‹è¯•ç»“æžœ" >> $GITHUB_STEP_SUMMARY
            echo "- **çŠ¶æ€**: éƒ¨åˆ†å¤±è´¥ï¼Œè¯¦è§æ—¥å¿—" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ -f "app_logs.txt" ] && [ -s "app_logs.txt" ]; then
            echo "- **åº”ç”¨æ—¥å¿—**: å·²æ”¶é›†" >> $GITHUB_STEP_SUMMARY
          else
            echo "- **åº”ç”¨æ—¥å¿—**: æ— æ—¥å¿—è¾“å‡º" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¦ ç”Ÿæˆçš„æ–‡ä»¶" >> $GITHUB_STEP_SUMMARY
          for file in screenshot.png app_logs.txt app/build/outputs/apk/foss/debug/app-foss-debug.apk; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              size=$(du -h "$file" | cut -f1)
              echo "- **${filename}** (${size})" >> $GITHUB_STEP_SUMMARY
            fi
          done
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”— ç›¸å…³é“¾æŽ¥" >> $GITHUB_STEP_SUMMARY
          echo "- [ðŸ“¦ æµ‹è¯•å·¥ä»¶](https://github.com/${GITHUB_REPOSITORY}/actions/runs/${GITHUB_RUN_ID})" >> $GITHUB_STEP_SUMMARY
          echo "- [ðŸ“Š å·¥ä½œæµåŽ†å²](https://github.com/${GITHUB_REPOSITORY}/actions/workflows/android-emulator-testing.yml)" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ job.status }}" != "success" ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### âš ï¸ æ³¨æ„äº‹é¡¹" >> $GITHUB_STEP_SUMMARY
            echo "æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥è¯¦ç»†æ—¥å¿—èŽ·å–æ›´å¤šä¿¡æ¯ã€‚" >> $GITHUB_STEP_SUMMARY
          fi
